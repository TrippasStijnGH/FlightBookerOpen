@model FlightBooker.ViewModels.ShoppingCartContentVM

@{
    ViewData["Title"] = "Shopping Cart";
    @if (Model?.Cart.Carts?.Any() == true)
    {
        

<div class="container mt-4">
    <h2 class="mb-4">Your Shopping Cart</h2>

            @if (Model?.Cart.Carts == null || !Model.Cart.Carts.Any())
    {
        <div class="alert alert-info">
            Your cart is empty. Please search for flights to add to your cart.
        </div>
    }
    else
    {
        <div class="journey-container">
                    @foreach (var cart in Model.Cart.Carts)
            {
                if (cart.Flights != null && cart.Flights.Any())
                {
                    var journey = cart.Flights;
                    var firstFlight = journey.First();
                    var lastFlight = journey.Last();
                            var journeyClass = cart.Class;

                    <div class="journey-card mb-4">
                        <!-- overkoepelend traject -->
                        <div class="journey-header rounded p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <h4>
                                    <i class="bi bi-airplane"></i> 
                                    @firstFlight.DepartCityName to @lastFlight.ArriveCityName
                                </h4>
                                <span class="badge bg-primary">@journeyClass</span>
                            </div>
                        </div>

                        <!-- enkele vluchten -->
                        <div class="flights-container p-3">
                            @for (int i = 0; i < Math.Min(journey.Count, 3); i++)
                            {
                                var flight = journey[i];
                                <div class="flight-card mb-3">
                                    <div class="flight-date-header p-2">
                                        <strong>@flight.DateTimeDepart.ToString("dddd, MMMM d, yyyy")</strong>
                                    </div>
                                    <div class="flight-details p-3">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="d-flex flex-column">
                                                    <span class="fs-5">@flight.LocalDateTimeDepart.ToString("HH:mm")</span>
                                                    <strong>@flight.DepartCityName</strong>
                                                </div>
                                            </div>
                                            <div class="col-md-4 text-center">
                                                <div class="flight-duration">
                                                    @{
                                                        var duration = flight.DateTimeArrive - flight.DateTimeDepart;
                                                        var formattedDuration = duration.Hours > 0 
                                                            ? $"{duration.Hours}h {duration.Minutes}m" 
                                                            : $"{duration.Minutes}m";
                                                    }
                                                    <div class="text-muted">@formattedDuration</div>
                                                    <div class="text-muted">@cart.TravelClass</div>
                                                </div>
                                            </div>
                                            <div class="col-md-4 text-end">
                                                <div class="d-flex flex-column">
                                                    <span class="fs-5">@flight.LocalDateTimeArrive.ToString("HH:mm")</span>
                                                    <strong>@flight.ArriveCityName</strong>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row mt-2">
                                            <div class="col-12 text-end">
                                                <div class="flight-price">
                                                    <span class="text-muted">Price:</span>
                                                    <span class="fs-5 ms-2">@((flight.RealPrice).ToString("C"))</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                                    @{
                                        decimal totalPrice = journey.Sum(f => f.RealPrice);
                                        var flightIds = string.Join(",", journey.Select(f => f.FlightID));

                                    }
                        </div>

                        <!-- Total Price & Booking Button -->
                        <div class="price-card p-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <span class="text-muted">Total Price:</span>
                                    <span>@cart.Price.ToString("C")</span>
                                </div>
                                
                                        <form asp-controller="Booking" asp-action="StartBookingProcessSC" method="post" class="d-inline">
                                            <input asp-for="TravelClass" class="form-control" type="hidden" value="@cart.TravelClass" />
                                            <input asp-for="FlightIds" class="form-control" type="hidden" value="@flightIds" />
                                            <input asp-for="BookingId" class="form-control" type="hidden" value="@cart.bookingID"/>
                                            <input asp-for="SelectedCartItemId" class="form-control" type="hidden" value="@cart.cartId" />

 
                                            <button type="submit" class="btn btn-primary">
                                                 Book Now
                                            </button>
                                        </form>
                                        <a asp-controller="ShoppingCart"
                                           asp-action="RemoveFromCart"
                                           asp-route-cartID="@cart.cartId"
                                           class="btn btn-primary">
                                            <i class="bi bi-check2-circle"></i> Remove from cart
                                        </a>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>

        <div class="d-flex justify-content-between align-items-center mt-4">
            <div>
                <span class="text-muted">Cart Total:</span>
                <span class="fs-4 ms-2 fw-bold">@Model.Cart.ComputeTotalValue().ToString("C")</span>
            </div>
            <div>
                <a href="@Url.Action("Index", "FlightSearch")" class="btn btn-outline-secondary me-2">Continue Shopping</a>
                
            </div>
        </div>
    }
    </div>
    }







    }





        
